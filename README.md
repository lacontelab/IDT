# Individualized Discounting Task (IDT) ####
The is a [PsychoPy (https://github.com/psychopy/psychopy) implementation of the _IDT_ , an adaptive individualized delay discounting task for functional magnetic resonance imaging as described in [Koffarnus et al. 2017](http://www.sciencedirect.com/science/article/pii/S1053811917306717).

## Install
Please follow the instructions provided by [PsychoPy](https://www.psychopy.org/download.html). If you are using [conda](https://docs.conda.io/en/latest/), you can simply use the following command to install:

    conda env create -n py36_IDT -f IDT.yml

 
## How to run

**Step 1:**  _initializer.py_: creates a configuration text file (config_initialize.txt) that contains subject ID and experiment session number

**Step 2:** _OutOfScanner.py_ :runs the discounting task. This is intended to be run out of the MRI scanner, and titrates choices over seven delays to return indifference points and the discounting rate (k-value). The script creates a data folder for each participant and outputs a .csv file that logs the input.

**Step 3:** _IDT.py_: runs the discounting task. This is intended to be run inside the MRI scanner. The task is individualized to the participant's k-value, which is calculated from *OutOfScanner.py*. Outputs a .csv log file for parsing and a log file containing all information during the task using psychopy's logging tool.

**Step 4:** _clean_files.py_: moves files that are left over from the tasks into the participant's data folder. This is only necessary if a task was stopped mid-way through

**Step 5:** _parser_IDT.py_: parses the .csv log file output by _IDT.py_. Outputs .1D AFNI stim files of interest in the form {stimulus_onset}:{stimulus_duration}.

## Auxillary Files #

_config_outofscanner.txt_:configuration file for *OutOfScanner.py,* governing keys used
_config_inscanner.txt_:configuration file for *IDT.py,* governing keys used

## AFNI Stim File Generation for fMRI analysis #

As mentioned in Step 5, the parser outputs .1D files that can be used in AFNI's 3dDeconvolve command. Trial types
that are generated by the parser (and have been previously studied) include:

        - "hard trials" and "easy trials": The indifference point calculated by OutOfScanner.py governs
          whether the trial is "hard" or "easy". If the shorter sooner amount of money is within 20% of the
          indifference point for the presented delay, then the trial is considered "hard". Otherwise, the
          trial is considered "easy".

        - "immediate choice available trials" and "immediate choice unavailable trials": Most trial types
          have a choice available "now". These are immediate choice available trials. Some trials have both
          choices delayed in time. These are immediate choice unavailavle trials.

        - "immediate trials" and "delayed trials": These trial types depend on whether the participant
          chose the immediate choice or the delayed choice.

        - "control trials" and "notcontrol trials": Control trials are those meeting one of the criteria:
                - Both monetary amounts are equivalent
                - Both temporal delays are equivalent
                - One of the monetary amounts is zero


